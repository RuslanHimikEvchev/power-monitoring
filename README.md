Цей проєкт було створено на запит житлового комплексу за для моніторингу наявності ~~електрохарчування~~ електрики в будинках житлового комплексу.  
Проєкт пережив кілька ітерацій і вийшов у фінальний варіант, який і працює зараз.  
Основна концепція, це надсилання періодичних http запитів на сервер з деякими корисними даними. Надсилати запити можна чим завгодно, що це вміє. В директорії esphome репозиторію ви можете знайти приклад прошивки для ESPHome під TTGO T-Beam та NodeMCU v3. Зверніть увагу, що при цьому використовуються два концептуально різні підходи. До прикладу, якщо устаткування здатно працювати якийсь час автономно, та може отримати статус електричної мережі, то можна використовувати метод прямого моніторингу. Якщо устаткування вміє тільки надсилати запити і при вимиканні живлення, воно також вимкнеться, тоді треба використовувати метод моніторингу по таймауту. В першому випадку ми отримаємо сповіщення про вимкнення живлення, або його появу, майже моментально. У другому випадку - затримка сповіщення  про вимкнення становить параметр і * 3. Тобто, якщо ми надсилаємо запит раз на хвилину, то мінімальний таймаут становить 180 сек, або 3 хвилини.

1. Бекенд  
   Для встановлення та налаштування бекенду, нам треба Go 1.21 або вище та Redis Server. Клонуємо репозиторій в потрібну нам директорію, та виконуємо команду  
   `go mod tidy`  
   Після цього можемо зібрати проєкт командою\
   `CGO_ENABLED=0 go build -o build/monitor -a -installsuffix cgo -ldflags '-s' main.go`
2. Перед запуском необхідно написати базову конфігурацію бекенду. Приклад конфігурації описаний у файлі config-example.yml
3. Надсилати дані в бекенд можна будь-яким способом, відправивши HTTP запит\
   Онлайн моніторинг
   ```http 
   POST https://top-domain.tld/direct-wire 
   ```
   Всі поля обов'язкові
   ```json lines
   {
   "k": "key_complex",  
   "n": "name of power line",
   "h": true,  
   "p": true,  
   "m": "MAC of device or another uniq id"  
   }
   ```
   Моніторинг за затримкою сповіщення
   ```http 
   POST https://top-domain.tld/timeout-wire 
   ```
   Всі поля обов'язкові
   ```json lines
   {
   "k": "key_complex",  
   "n": "name of power line",
   "i": 60,
   "m": "MAC of device or another uniq id"  
   }
   ```
   
   
   Де:\
   **k - ключ будинку**\
   **n - нумерація силової лінії в будинку або її ім'я**\
   **i - як часто відбувається цей http запит. Необхідний для коректного розрахунку таймауту перед сповіщенням про вимкнення**\
   **h - чи виконується моніторинг струму напряму**\
   **p - чи є струм в лінії**\
   **m - унікальний ідентифікатор лінії**